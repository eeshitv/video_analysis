
clear all;


res=0.11; % this is determined by the microscopes, it is 0.2125 if you have 0.2125 microns per pixel, 0.1417 for spn


%%Loading the data
load('/Users/eesh/Desktop/video_analysis_data/water_injection/Image5_121813/Measurements/Membranes--vertices--Vertex-x.mat');
datax=data;
cell_number=size(datax,3); % This just assigns 109 to the cel_number for the given file
load('/Users/eesh/Desktop/video_analysis_data/water_injection/Image5_121813/Measurements/Membranes--vertices--Vertex-y.mat'); %this loads the y 
datay=data;

cell_number=size(datay,3); % This just assigns 109 to the cel_number for the given file


datax{1,1,50}

%nox_vertices=zeros(1,cell_number);
%for i=1:cell_number,
%    nox_vertices(i) = size(data{1,1,i},1); %this is
%end
%nox_vertices;
for time=1:40,
entropy=[];
%%sprintf is awesome!
image_path=strcat('/Users/eesh/Desktop/video_analysis_data/water_injection/Image5_121813/Myosin/Image5_121813_t',sprintf('%03d',time),'_z006_c001.tif')  ;  
A=imread(image_path); 
A_hold=A;

imshow(A);
A=double(A);



for cell_index=1:cell_number, %this mega for loop calculates the COM for all the cells which are taken from the edge output
    
  tx = datax{1,1,cell_index}'./res;

    ty = datay{1,1,cell_index}'./res;

     vert_cell=size(tx,2);
   t_poly=zeros(vert_cell,2);

   for i=1:vert_cell,
       t_poly(i ,1)=tx(i);
       t_poly(i ,2)=ty(i);
   end

   t_poly;
   
   
  
  
    
    %%PROBABILITY USING IMHIST
    %%CUTTING INTO POLYGONS
    BW=roipoly(A,tx,ty);
    BW=double(BW);
   % SE = strel('octagon',3);
    %BW = imerode(BW,SE);    %eroding the edges
    
    ANS=BW.*A;
    ANS=uint8(ANS);
    probability=imhist(ANS)/(size(A,1)*size(A,2));
    %%this , as log(0) is -infinity, we ignore those values
    ln=log(probability);
    ln(~isfinite(ln))=0;
    
    entropy= [ entropy ; ( -ln)' * (probability)];
    
  
end

E(time).entropy=entropy;

end

%%
%load('roki_image5');

test=[];

for t=1:60,
   
    test=[test;E(t).entropy(50)];
    
end

plot(test)
xlabel('TIME');
ylabel('ENTROPY');
hx_1 = graph2d.constantline(30, 'Color',[1 0 0]);
changedependvar(hx_1,'x');